openapi: 3.0.3
info:
  title: ShopMatch Pro API
  description: |
    RESTful API for ShopMatch Pro job board platform.

    **Authentication**: All endpoints (except /api/health) require Firebase authentication.
    Include the Firebase ID token in the Authorization header as `Bearer <token>`.

    **Base URL**: Dynamic - uses Vercel URL in deployments, localhost:3000 in development.
    See docs/DEPLOYMENT.md for base URL configuration.

    **Error Handling**: All endpoints return standardized error responses with:
    - `error`: Human-readable error message
    - `details`: Optional additional error context (422 validation errors include Zod error format)

    **Rate Limiting**: Currently implemented only for CSV export (5 exports per hour).

  version: 1.0.0
  contact:
    name: ShopMatch Pro Support
    url: https://github.com/RazonIn4K/shopmatch-pro

servers:
  - url: http://localhost:3000
    description: Local development server
  - url: https://shopmatch-pro.vercel.app
    description: Production server (example - replace with actual domain)

tags:
  - name: System
    description: System health and status endpoints
  - name: Authentication
    description: User authentication and authorization
  - name: Stripe
    description: Subscription and payment processing
  - name: Jobs
    description: Job posting management
  - name: Applications
    description: Job application management

paths:
  /api/health:
    get:
      tags: [System]
      summary: Health check endpoint
      description: |
        Comprehensive system health check that validates:
        - Environment variable configuration (13 required variables)
        - Firebase client SDK initialization
        - Stripe SDK configuration

        **No authentication required** - used by monitoring systems.
      operationId: getHealth
      responses:
        '200':
          description: System healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheckResponse'
              examples:
                healthy:
                  value:
                    status: ok
                    timestamp: "2025-10-18T07:00:00.000Z"
                    environment: production
                    checks:
                      firebase: true
                      stripe: true
                      environment: true
                missingEnv:
                  value:
                    status: error
                    timestamp: "2025-10-18T07:00:00.000Z"
                    environment: production
                    checks:
                      firebase: false
                      stripe: false
                      environment: false
                    errors: ["Missing 3 required environment variables"]
                    envDetails:
                      totalRequired: 13
                      totalPresent: 10
                      missingCount: 3
                      missingVars: ["STRIPE_WEBHOOK_SECRET", "FIREBASE_PRIVATE_KEY", "FIREBASE_CLIENT_EMAIL"]

  /api/users/initialize-claims:
    post:
      tags: [Authentication]
      summary: Initialize custom claims after signup
      description: |
        Sets initial Firebase custom claims for a newly registered user.
        Called automatically after user creation to set up:
        - User role (owner/seeker)
        - Subscription status (subActive: false initially)

        **Authentication required**: Must be called by the user themselves.
      operationId: initializeClaims
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role]
              properties:
                role:
                  type: string
                  enum: [owner, seeker]
                  description: User role to initialize
      responses:
        '200':
          description: Claims initialized successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Custom claims initialized successfully"
        '400':
          description: Missing or invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/stripe/checkout:
    post:
      tags: [Stripe]
      summary: Create Stripe Checkout session
      description: |
        Creates a Stripe Checkout Session for Pro subscription purchase.
        Returns a session URL to redirect the user to Stripe's hosted checkout page.

        **Flow**:
        1. User clicks "Subscribe" button
        2. Frontend calls this endpoint
        3. Backend creates Stripe session with user ID
        4. Frontend redirects to session.url
        5. User completes payment on Stripe
        6. Stripe webhook updates subscription status
        7. User redirected to /dashboard?success=true

        **Authentication required**: User must be logged in.
      operationId: createCheckoutSession
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Checkout session created
          content:
            application/json:
              schema:
                type: object
                required: [url, sessionId]
                properties:
                  url:
                    type: string
                    format: uri
                    description: Stripe Checkout page URL to redirect user to
                    example: "https://checkout.stripe.com/c/pay/cs_test_..."
                  sessionId:
                    type: string
                    description: Checkout session ID for tracking
                    example: "cs_test_a1b2c3d4e5f6g7h8i9j0"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags: [Stripe]
      summary: Get checkout endpoint information
      description: Development/debugging endpoint - provides configuration info
      operationId: getCheckoutInfo
      responses:
        '200':
          description: Checkout configuration information
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  note:
                    type: string
                  config:
                    type: object

  /api/stripe/portal:
    post:
      tags: [Stripe]
      summary: Create customer portal session
      description: |
        Creates a Stripe Customer Portal session for subscription management.
        Users can update payment methods, cancel subscriptions, and view invoices.

        **Authentication required**: User must be logged in with active subscription.
      operationId: createPortalSession
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Portal session created
          content:
            application/json:
              schema:
                type: object
                required: [url]
                properties:
                  url:
                    type: string
                    format: uri
                    description: Stripe Customer Portal URL
                    example: "https://billing.stripe.com/p/session/..."
        '400':
          description: No Stripe customer ID found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: User document not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/stripe/webhook:
    post:
      tags: [Stripe]
      summary: Stripe webhook endpoint
      description: |
        Receives webhook events from Stripe for subscription lifecycle management.

        **Handles events**:
        - `checkout.session.completed` - Links Stripe customer to Firebase user
        - `customer.subscription.created` - Sets subActive custom claim to true
        - `customer.subscription.updated` - Updates subscription status
        - `customer.subscription.deleted` - Sets subActive custom claim to false

        **Security**: Verifies webhook signature using raw request body.

        **No authentication required** - uses webhook signature verification.
      operationId: handleWebhook
      requestBody:
        required: true
        description: Raw webhook payload from Stripe (signature verified)
        content:
          application/json:
            schema:
              type: object
              description: Stripe Event object (varies by event type)
      responses:
        '200':
          description: Webhook processed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  received:
                    type: boolean
                    example: true
        '400':
          description: Webhook signature verification failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/jobs:
    get:
      tags: [Jobs]
      summary: List jobs with filtering and pagination
      description: |
        Returns jobs with extensive filtering support and pagination.

        **Query parameters** (all optional):
        - `ownerId`: Filter by job owner Firebase UID
        - `status`: Filter by status (draft, published, closed)
        - `type`: Filter by employment type (full-time, part-time, contract, freelance)
        - `location`: Filter by location string (partial match)
        - `remote`: Filter for remote jobs (true/false)
        - `experience`: Filter by experience level (entry, mid, senior, lead)
        - `page`: Page number (default: 1, min: 1)
        - `limit`: Results per page (default: 20, min: 1, max: 100)

        **Response**: Returns paginated results with pagination metadata.

        **Authentication**: Optional - unauthenticated users can browse published jobs.
      operationId: listJobs
      parameters:
        - in: query
          name: ownerId
          schema:
            type: string
          description: Filter by job owner Firebase UID
        - in: query
          name: status
          schema:
            type: string
            enum: [draft, published, closed]
          description: Filter by job status
        - in: query
          name: type
          schema:
            type: string
            enum: [full-time, part-time, contract, freelance]
          description: Filter by employment type
        - in: query
          name: location
          schema:
            type: string
          description: Filter by location (partial match)
        - in: query
          name: remote
          schema:
            type: boolean
          description: Filter for remote jobs
        - in: query
          name: experience
          schema:
            type: string
            enum: [entry, mid, senior, lead]
          description: Filter by experience level
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Results per page
      responses:
        '200':
          description: Paginated list of jobs
          content:
            application/json:
              schema:
                type: object
                required: [jobs, pagination]
                properties:
                  jobs:
                    type: array
                    items:
                      $ref: '#/components/schemas/Job'
                  pagination:
                    type: object
                    required: [page, limit, total, totalPages]
                    properties:
                      page:
                        type: integer
                        example: 1
                      limit:
                        type: integer
                        example: 20
                      total:
                        type: integer
                        description: Total matching jobs
                        example: 45
                      totalPages:
                        type: integer
                        example: 3
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags: [Jobs]
      summary: Create job posting
      description: |
        Creates a new job posting.

        **Requirements**:
        - User must have "owner" role
        - User must have active subscription (subActive: true)

        **Authentication required**: Owner with active subscription.
      operationId: createJob
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobCreateRequest'
      responses:
        '201':
          description: Job created successfully
          content:
            application/json:
              schema:
                type: object
                required: [message, job]
                properties:
                  message:
                    type: string
                    example: "Job created successfully"
                  job:
                    $ref: '#/components/schemas/Job'
        '400':
          description: Invalid JSON payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Active subscription required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validation failed (Zod schema validation)
          content:
            application/json:
              schema:
                type: object
                required: [error, details]
                properties:
                  error:
                    type: string
                    example: "Validation failed"
                  details:
                    type: object
                    description: Zod error format with field-level validation issues
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/jobs/{id}:
    get:
      tags: [Jobs]
      summary: Get job details
      description: |
        Retrieves a single job posting by ID.

        **Authentication**: Optional for published jobs, required for draft jobs.
        - Published jobs: accessible to everyone
        - Draft jobs: only accessible to owner

        **Side effects**: Increments view count for published jobs.
      operationId: getJob
      parameters:
        - $ref: '#/components/parameters/JobIdParam'
      responses:
        '200':
          description: Job details
          content:
            application/json:
              schema:
                type: object
                required: [job]
                properties:
                  job:
                    $ref: '#/components/schemas/Job'
        '404':
          description: Job not found (or draft job accessed by non-owner)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags: [Jobs]
      summary: Update job posting
      description: |
        Updates an existing job posting using PUT (replaces all fields).

        **Ownership verification**: User must be the job owner (Firestore canonical ownership check).

        **Side effects**: Sets `publishedAt` timestamp when transitioning from draft to published.

        **Authentication required**: Owner of the job with active subscription.
      operationId: updateJob
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/JobIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobUpdateRequest'
      responses:
        '200':
          description: Job updated successfully
          content:
            application/json:
              schema:
                type: object
                required: [message, job]
                properties:
                  message:
                    type: string
                    example: "Job updated successfully"
                  job:
                    $ref: '#/components/schemas/Job'
        '400':
          description: Invalid JSON payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: User does not own this job or subscription inactive
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validation failed (Zod schema validation)
          content:
            application/json:
              schema:
                type: object
                required: [error, details]
                properties:
                  error:
                    type: string
                    example: "Validation failed"
                  details:
                    type: object
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags: [Jobs]
      summary: Delete job posting
      description: |
        Deletes a job posting.

        **Ownership verification**: User must be the job owner.

        **Cascade behavior**: DOES NOT delete associated applications (cascade code commented out).
        Future implementation may include cascade deletion.

        **Authentication required**: Owner of the job with active subscription.
      operationId: deleteJob
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/JobIdParam'
      responses:
        '200':
          description: Job deleted successfully
          content:
            application/json:
              schema:
                type: object
                required: [message]
                properties:
                  message:
                    type: string
                    example: "Job deleted successfully"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: User does not own this job or subscription inactive
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/jobs/{id}/apply:
    post:
      tags: [Applications]
      summary: Submit job application
      description: |
        Submits an application to a job posting.

        **Requirements**:
        - User must have "seeker" role
        - Job must exist and be published
        - Cannot apply twice to same job (enforced by Firestore unique index)

        **Note**: The spec previously claimed "cannot apply to own jobs" but this is NOT enforced in the implementation.

        **Authentication required**: Seeker role.
      operationId: applyToJob
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/JobIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicationCreateRequest'
      responses:
        '201':
          description: Application submitted successfully
          content:
            application/json:
              schema:
                type: object
                required: [message, application]
                properties:
                  message:
                    type: string
                    example: "Application submitted successfully"
                  application:
                    $ref: '#/components/schemas/Application'
        '400':
          description: Invalid JSON payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Seeker role required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Duplicate application (already applied to this job)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validation failed
          content:
            application/json:
              schema:
                type: object
                required: [error, details]
                properties:
                  error:
                    type: string
                    example: "Validation failed"
                  details:
                    type: object
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/applications:
    get:
      tags: [Applications]
      summary: List applications with filtering
      description: |
        Returns applications filtered by user role:
        - **Owners**: Applications to their job postings
        - **Seekers**: Their own submitted applications

        **Query parameters** (all optional):
        - `jobId`: Filter by specific job ID
        - `seekerId`: Filter by seeker Firebase UID (owner only)
        - `status`: Filter by application status (pending, reviewed, accepted, rejected)

        **Authentication required**: User must be logged in.
      operationId: listApplications
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: jobId
          schema:
            type: string
          description: Filter applications by job ID
          example: "job_abc123"
        - in: query
          name: seekerId
          schema:
            type: string
          description: Filter by seeker UID (owner only)
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, reviewed, accepted, rejected]
          description: Filter by application status
      responses:
        '200':
          description: List of applications
          content:
            application/json:
              schema:
                type: object
                required: [applications]
                properties:
                  applications:
                    type: array
                    items:
                      $ref: '#/components/schemas/Application'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/applications/export:
    get:
      tags: [Applications]
      summary: Export applications as CSV
      description: |
        Exports all applications for jobs owned by the authenticated user as CSV file.

        **Requirements**:
        - User must have "owner" role
        - User must have posted at least one job
        - At least one application must exist for user's jobs

        **Rate limiting**: 5 exports per hour per user (enforced with X-RateLimit headers).

        **CSV columns**:
        - Job Title
        - Applicant Email
        - Status
        - Cover Letter
        - Applied At (timestamp)
        - Last Updated (timestamp)

        **Authentication required**: Owner role.
      operationId: exportApplicationsCSV
      security:
        - bearerAuth: []
      responses:
        '200':
          description: CSV file with all applications
          content:
            text/csv:
              schema:
                type: string
                format: binary
          headers:
            Content-Disposition:
              schema:
                type: string
                example: 'attachment; filename="applications-export-2025-10-18.csv"'
            X-RateLimit-Limit:
              schema:
                type: string
                example: "5"
            X-RateLimit-Remaining:
              schema:
                type: string
                example: "4"
            X-RateLimit-Reset:
              schema:
                type: string
                description: Unix timestamp when rate limit resets
                example: "1729258800000"
        '401':
          description: Missing or invalid authentication
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Owner role required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: No jobs or no applications found
          content:
            application/json:
              schema:
                type: object
                required: [error, message]
                properties:
                  error:
                    type: string
                    example: "No applications found"
                  message:
                    type: string
                    example: "No applications have been submitted to your jobs"
        '429':
          description: Rate limit exceeded (5 exports per hour)
          content:
            application/json:
              schema:
                type: object
                required: [error, message, retryAfter, limit, remaining, reset]
                properties:
                  error:
                    type: string
                    example: "Rate limit exceeded"
                  message:
                    type: string
                    example: "You can export up to 5 times per hour. Please try again in 45 minutes."
                  retryAfter:
                    type: integer
                    description: Seconds until rate limit reset
                    example: 2700
                  limit:
                    type: integer
                    example: 5
                  remaining:
                    type: integer
                    example: 0
                  reset:
                    type: integer
                    description: Unix timestamp when rate limit resets
                    example: 1729258800000
          headers:
            Retry-After:
              schema:
                type: string
                example: "2700"
            X-RateLimit-Limit:
              schema:
                type: string
                example: "5"
            X-RateLimit-Remaining:
              schema:
                type: string
                example: "0"
            X-RateLimit-Reset:
              schema:
                type: string
                example: "1729258800000"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/applications/{id}:
    get:
      tags: [Applications]
      summary: Get application details
      description: |
        Retrieves a single application by ID.

        **Access control**:
        - Seeker can view their own applications
        - Owner can view applications to their jobs

        **Authentication required**: Seeker (own application) or Owner (job owner).
      operationId: getApplication
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/ApplicationIdParam'
      responses:
        '200':
          description: Application details
          content:
            application/json:
              schema:
                type: object
                required: [application]
                properties:
                  application:
                    $ref: '#/components/schemas/Application'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Insufficient permissions to view this application
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Application not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

    patch:
      tags: [Applications]
      summary: Update application status
      description: |
        Updates the status of a job application.

        **Allowed status transitions** (owner only):
        - pending → reviewed
        - pending → accepted
        - pending → rejected
        - reviewed → accepted
        - reviewed → rejected

        **Ownership verification**: User must own the job this application is for.

        **Side effects**: Sets `reviewedAt` timestamp when transitioning from pending to any other status.

        **Authentication required**: Owner of the job.
      operationId: updateApplication
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/ApplicationIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplicationUpdateRequest'
      responses:
        '200':
          description: Application updated successfully
          content:
            application/json:
              schema:
                type: object
                required: [message, application]
                properties:
                  message:
                    type: string
                    example: "Application updated successfully"
                  application:
                    $ref: '#/components/schemas/Application'
        '400':
          description: Invalid JSON payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: User does not own the job or not an owner
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Application not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validation failed
          content:
            application/json:
              schema:
                type: object
                required: [error, details]
                properties:
                  error:
                    type: string
                    example: "Validation failed"
                  details:
                    type: object
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Firebase ID token obtained after user authentication.

        **How to obtain**:
        1. User signs in via Firebase Auth (email/password or Google OAuth)
        2. Firebase Auth returns ID token
        3. Frontend includes token in Authorization header: `Bearer <token>`

        **Token refresh**: Tokens expire after 1 hour. Frontend must refresh before expiration.

  parameters:
    JobIdParam:
      in: path
      name: id
      required: true
      schema:
        type: string
      description: Firestore job document ID
      example: "job_abc123"

    ApplicationIdParam:
      in: path
      name: id
      required: true
      schema:
        type: string
      description: Firestore application document ID
      example: "app_xyz789"

  schemas:
    HealthCheckResponse:
      type: object
      required: [status, timestamp, environment, checks]
      properties:
        status:
          type: string
          enum: [ok, error]
          description: Overall system status
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of health check
        environment:
          type: string
          description: Node.js environment (development, production, test)
          example: "production"
        checks:
          type: object
          required: [firebase, stripe, environment]
          properties:
            firebase:
              type: boolean
              description: Firebase client SDK initialization status
            stripe:
              type: boolean
              description: Stripe SDK configuration status
            environment:
              type: boolean
              description: Environment variable validation status
        errors:
          type: array
          items:
            type: string
          description: Error messages (only when status is error)
        envDetails:
          type: object
          description: Detailed environment validation (only when checks.environment is false)
          properties:
            totalRequired:
              type: integer
              example: 13
            totalPresent:
              type: integer
              example: 10
            missingCount:
              type: integer
              example: 3
            missingVars:
              type: array
              items:
                type: string
              example: ["STRIPE_WEBHOOK_SECRET", "FIREBASE_PRIVATE_KEY"]

    Job:
      type: object
      required: [id, ownerId, title, description, company, location, type, status, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Firestore document ID
          example: "job_abc123"
        ownerId:
          type: string
          description: Firebase UID of job poster
          example: "user_xyz789"
        title:
          type: string
          description: Job title
          example: "Senior Full-Stack Engineer"
        description:
          type: string
          description: Detailed job description (Markdown supported)
          example: "We are looking for an experienced full-stack engineer..."
        company:
          type: string
          description: Company name
          example: "ShopMatch Inc."
        location:
          type: string
          description: Job location (city, remote, hybrid)
          example: "San Francisco, CA (Remote)"
        type:
          type: string
          enum: [full-time, part-time, contract, freelance]
          description: Employment type
        salary:
          type: object
          description: Optional salary range
          properties:
            min:
              type: number
              example: 120000
            max:
              type: number
              example: 180000
            currency:
              type: string
              example: "USD"
        status:
          type: string
          enum: [draft, published, closed]
          description: Job posting status
        viewCount:
          type: integer
          description: Number of times job has been viewed (incremented on GET)
          example: 42
        createdAt:
          type: string
          format: date-time
          description: Firestore server timestamp
        updatedAt:
          type: string
          format: date-time
          description: Firestore server timestamp
        publishedAt:
          type: string
          format: date-time
          description: Timestamp when job was first published (set on draft → published transition)
        expiresAt:
          type: string
          format: date-time
          description: Optional expiration date

    JobCreateRequest:
      type: object
      required: [title, description, company, location, type]
      properties:
        title:
          type: string
          minLength: 3
          maxLength: 200
          example: "Senior Full-Stack Engineer"
        description:
          type: string
          minLength: 50
          maxLength: 10000
          example: "We are looking for an experienced full-stack engineer..."
        company:
          type: string
          minLength: 2
          maxLength: 100
          example: "ShopMatch Inc."
        location:
          type: string
          minLength: 2
          maxLength: 200
          example: "San Francisco, CA (Remote)"
        type:
          type: string
          enum: [full-time, part-time, contract, freelance]
        salary:
          type: object
          properties:
            min:
              type: number
              minimum: 0
            max:
              type: number
              minimum: 0
            currency:
              type: string
              example: "USD"
        status:
          type: string
          enum: [draft, published]
          default: draft

    JobUpdateRequest:
      type: object
      description: All fields required (PUT semantics - replaces entire job)
      required: [title, description, company, location, type, status]
      properties:
        title:
          type: string
          minLength: 3
          maxLength: 200
        description:
          type: string
          minLength: 50
          maxLength: 10000
        company:
          type: string
          minLength: 2
          maxLength: 100
        location:
          type: string
          minLength: 2
          maxLength: 200
        type:
          type: string
          enum: [full-time, part-time, contract, freelance]
        salary:
          type: object
          properties:
            min:
              type: number
            max:
              type: number
            currency:
              type: string
        status:
          type: string
          enum: [draft, published, closed]

    Application:
      type: object
      required: [id, jobId, seekerId, ownerId, status, createdAt, updatedAt]
      properties:
        id:
          type: string
          description: Firestore document ID
          example: "app_xyz789"
        jobId:
          type: string
          description: Reference to jobs collection
          example: "job_abc123"
        seekerId:
          type: string
          description: Firebase UID of applicant
          example: "user_seeker123"
        ownerId:
          type: string
          description: Job owner UID (denormalized for queries)
          example: "user_owner456"
        status:
          type: string
          enum: [pending, reviewed, accepted, rejected]
          description: Application status
        coverLetter:
          type: string
          description: Optional cover letter text
          example: "I am very interested in this position..."
        notes:
          type: string
          description: Owner notes on application (owner only, not visible to seeker)
        resumeUrl:
          type: string
          format: uri
          description: Cloud Storage URL for resume (optional, future feature)
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        reviewedAt:
          type: string
          format: date-time
          description: Timestamp when status changed from pending (set automatically)

    ApplicationCreateRequest:
      type: object
      properties:
        coverLetter:
          type: string
          maxLength: 5000
          description: Optional cover letter
          example: "I am very interested in this position..."

    ApplicationUpdateRequest:
      type: object
      required: [status]
      properties:
        status:
          type: string
          enum: [reviewed, accepted, rejected]
          description: New status (only owner can update)
        notes:
          type: string
          maxLength: 2000
          description: Optional owner notes on application

    ErrorResponse:
      type: object
      required: [error]
      properties:
        error:
          type: string
          description: Human-readable error message
          example: "Invalid request parameters"
        message:
          type: string
          description: Additional human-friendly explanation
        details:
          type: object
          description: Optional additional error context (422 errors include Zod format)
          example: { "_errors": [], "title": { "_errors": ["String must contain at least 3 character(s)"] } }

  responses:
    UnauthorizedError:
      description: Missing or invalid authentication token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Unauthorized"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Internal server error"

security:
  - bearerAuth: []
